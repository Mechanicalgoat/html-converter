<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML/SVG/スライドコンバーター</title>
    <style>
        :root {
            --primary-dark: #2A2D34;
            --primary-blue: #4A90E2;
            --primary-light: #FFFFFF;
            --accent-blue: #0095DA;
            --secondary-blue: #5C2D91;
            --accent-purple: #A100FF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .converter-container {
            background-color: var(--primary-light);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            padding: 30px;
        }

        .file-drop-zone {
            border: 2px dashed var(--primary-blue);
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .file-drop-zone.drag-over {
            background-color: rgba(74, 144, 226, 0.1);
            border-color: var(--primary-blue);
        }

        #file-input {
            display: none;
        }

        .drop-text {
            color: var(--primary-dark);
            font-size: 18px;
        }

        .preview-container {
            margin-top: 20px;
            max-height: 400px;
            overflow: auto;
            border: 1px solid var(--primary-blue);
            border-radius: 8px;
        }

        .conversion-options {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .btn {
            background-color: var(--primary-blue);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .btn:hover {
            background-color: var(--secondary-blue);
        }

        .btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        #status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        .success {
            background-color: rgba(76, 175, 80, 0.1);
            color: #4CAF50;
        }

        .error {
            background-color: rgba(244, 67, 54, 0.1);
            color: #F44336;
        }
    </style>
</head>
<body>
    <div class="converter-container">
        <div id="file-drop-zone" class="file-drop-zone">
            <input type="file" id="file-input" accept=".html,.htm,.svg">
            <label for="file-input" class="btn">ファイルを選択</label>
            <p class="drop-text">またはここにファイルをドラッグ&ドロップ</p>
        </div>

        <div class="conversion-options">
            <select id="output-format">
                <option value="pdf">PDF</option>
                <option value="png">PNG</option>
                <option value="svg">SVG</option>
            </select>
            <button id="convert-btn" class="btn" disabled>変換</button>
        </div>

        <div id="preview-container" class="preview-container">
            <div id="preview"></div>
        </div>

        <div id="status-message"></div>
    </div>

    <script>
        // グローバル変数
        let fileContent = null;
        let fileType = null;

        // DOM要素の取得
        const fileDropZone = document.getElementById('file-drop-zone');
        const fileInput = document.getElementById('file-input');
        const convertBtn = document.getElementById('convert-btn');
        const previewContainer = document.getElementById('preview');
        const statusMessage = document.getElementById('status-message');
        const outputFormat = document.getElementById('output-format');

        // デフォルトのドラッグ&ドロップイベント防止
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            fileDropZone.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        // ドラッグ時のスタイル変更
        fileDropZone.addEventListener('dragenter', highlight, false);
        fileDropZone.addEventListener('dragover', highlight, false);
        fileDropZone.addEventListener('dragleave', unhighlight, false);
        fileDropZone.addEventListener('drop', handleDrop, false);

        function highlight() {
            fileDropZone.classList.add('drag-over');
        }

        function unhighlight() {
            fileDropZone.classList.remove('drag-over');
        }

        // ファイル入力イベント
        fileInput.addEventListener('change', handleFiles, false);

        function handleDrop(e) {
            unhighlight();
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFileSelect(files[0]);
        }

        function handleFiles() {
            handleFileSelect(this.files[0]);
        }

        function handleFileSelect(file) {
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                fileContent = e.target.result;
                fileType = file.name.split('.').pop().toLowerCase();

                // プレビュー表示
                displayPreview(fileContent, fileType);

                // 変換ボタンを有効化
                convertBtn.disabled = false;

                // ステータスメッセージ
                showStatus('ファイルが正常に読み込まれました', 'success');
            };

            reader.onerror = function() {
                showStatus('ファイルの読み込みに失敗しました', 'error');
            };

            reader.readAsText(file);
        }

        function displayPreview(content, type) {
            previewContainer.innerHTML = '';

            if (type === 'svg') {
                // SVGの場合はそのまま表示
                previewContainer.innerHTML = content;
            } else {
                // HTMLの場合はiframeで表示
                const iframe = document.createElement('iframe');
                iframe.style.width = '100%';
                iframe.style.height = '400px';
                iframe.style.border = 'none';
                previewContainer.appendChild(iframe);

                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                iframeDoc.open();
                iframeDoc.write(content);
                iframeDoc.close();
            }
        }

        // 変換ボタンのイベントリスナー
        convertBtn.addEventListener('click', convertFile);

        function convertFile() {
            if (!fileContent) {
                showStatus('ファイルが選択されていません', 'error');
                return;
            }

            const format = outputFormat.value;

            try {
                switch(format) {
                    case 'pdf':
                        convertToPdf(fileContent, fileType);
                        break;
                    case 'png':
                        convertToPng(fileContent, fileType);
                        break;
                    case 'svg':
                        convertToSvg(fileContent, fileType);
                        break;
                }
            } catch (error) {
                showStatus(`変換中にエラーが発生しました: ${error.message}`, 'error');
                console.error(error);
            }
        }

        // PDFに変換
        function convertToPdf(content, fileType) {
            // html2canvasとjsPDFを動的に読み込む
            Promise.all([
                loadScript('https://html2canvas.hertzen.com/dist/html2canvas.min.js'),
                loadScript('https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js')
            ]).then(() => {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF();

                // テキストとして追加（簡易的な実装）
                pdf.setFontSize(10);
                const splitText = pdf.splitTextToSize(content, 180);
                pdf.text(splitText, 10, 10);

                pdf.save(`converted_${new Date().toISOString().replace(/[:.]/g, '')}.pdf`);
                showStatus('PDFに変換しました', 'success');
            }).catch(error => {
                showStatus('PDFライブラリの読み込みに失敗しました', 'error');
            });
        }

        // PNGに変換
        function convertToPng(content, fileType) {
            // html2canvasを動的に読み込む
            loadScript('https://html2canvas.hertzen.com/dist/html2canvas.min.js')
            .then(() => {
                const element = fileType === 'svg' 
                    ? document.querySelector('svg') 
                    : document.querySelector('iframe').contentDocument.body;

                html2canvas(element).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `converted_${new Date().toISOString().replace(/[:.]/g, '')}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    showStatus('PNGに変換しました', 'success');
                });
            }).catch(error => {
                showStatus('html2canvasの読み込みに失敗しました', 'error');
            });
        }

        // SVGに変換
        function convertToSvg(content, fileType) {
            const blob = new Blob([content], {type: 'image/svg+xml'});
            const link = document.createElement('a');
            link.download = `converted_${new Date().toISOString().replace(/[:.]/g, '')}.svg`;
            link.href = URL.createObjectURL(blob);
            link.click();
            
            showStatus('SVGとして保存しました', 'success');
        }

        // ステータスメッセージ表示
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = type;
        }

        // スクリプトを動的に読み込む関数
        function loadScript(url) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = url;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
    </script>
</body>
</html>
