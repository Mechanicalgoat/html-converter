<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML/SVG コンバーター</title>
    
    <!-- CSSの読み込み -->
    <style>
        /* Tailwind CSSの基本スタイル */
        @tailwind base;
        @tailwind components;
        @tailwind utilities;

        /* カスタムスタイル */
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
    
    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- CDNからライブラリを読み込み -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-2xl bg-white shadow-xl rounded-lg p-8">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">HTML/SVG コンバーター</h1>
        
        <!-- ファイル選択 -->
        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center mb-6 hover:border-blue-500 transition-colors group">
            <input type="file" id="html-file" accept=".html,.htm,.svg" class="hidden" />
            <label for="html-file" class="cursor-pointer flex flex-col items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400 group-hover:text-blue-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <p class="text-gray-600 group-hover:text-blue-600">HTMLまたはSVGファイルをドラッグ＆ドロップするか、クリックして選択</p>
            </label>
            <div id="file-name" class="mt-2 text-sm text-blue-600 font-medium"></div>
        </div>
        
        <!-- 変換オプション -->
        <div class="grid grid-cols-2 gap-6 mb-6">
            <!-- サイズ選択 -->
            <div>
                <h3 class="text-lg font-semibold text-gray-700 mb-3">出力サイズ</h3>
                <div class="grid grid-cols-3 gap-2">
                    <button id="size-a4" class="size-button" data-size="a4">A4</button>
                    <button id="size-letter" class="size-button" data-size="letter">レター</button>
                    <button id="size-custom" class="size-button" data-size="custom">カスタム</button>
                </div>
            </div>
            
            <!-- 形式選択 -->
            <div>
                <h3 class="text-lg font-semibold text-gray-700 mb-3">出力形式</h3>
                <div class="grid grid-cols-3 gap-2">
                    <button id="format-pdf" class="format-button" data-format="pdf">PDF</button>
                    <button id="format-jpg" class="format-button" data-format="jpg">JPG</button>
                    <button id="format-svg" class="format-button" data-format="svg">SVG</button>
                </div>
            </div>
        </div>
        
        <!-- 品質設定 -->
        <div id="quality-options" class="mb-6" style="display: none;">
            <h3 class="text-lg font-semibold text-gray-700 mb-3">JPG品質</h3>
            <div class="flex items-center space-x-4">
                <input type="range" id="quality-slider" class="flex-grow" min="10" max="100" value="80">
                <span id="quality-value" class="w-12 text-right text-gray-600">80%</span>
            </div>
        </div>
        
        <!-- ページオプション -->
        <div id="page-options" class="bg-gray-100 rounded-lg p-4 mb-6" style="display: none;">
            <h3 class="text-lg font-semibold text-gray-700 mb-3">
                ページオプション <span id="page-info" class="text-sm text-gray-500"></span>
            </h3>
            <div class="space-y-2">
                <div class="flex items-center">
                    <input type="radio" id="all-pages" name="page-selection" value="all" class="mr-2" checked>
                    <label for="all-pages">すべてのページを変換</label>
                </div>
                <div class="flex items-center">
                    <input type="radio" id="single-page" name="page-selection" value="single" class="mr-2">
                    <label for="single-page" class="flex items-center">
                        選択したページのみ: 
                        <input type="number" id="page-number" class="ml-2 w-16 px-2 py-1 border rounded" min="1" value="1">
                    </label>
                </div>
            </div>
        </div>
        
        <!-- 変換ボタン -->
        <div class="flex space-x-4">
            <button id="preview-btn" class="flex-1 bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors disabled:bg-gray-300" disabled>
                プレビュー
            </button>
            <button id="convert-btn" class="flex-1 bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 transition-colors disabled:bg-gray-300" disabled>
                変換
            </button>
        </div>
        
        <!-- ステータスメッセージ -->
        <div id="status-message" class="mt-4 p-3 rounded-lg text-center"></div>
        
        <!-- 推定変換時間 -->
        <div id="estimated-time" class="mt-2 text-sm text-gray-600 text-center"></div>
        
        <!-- プレビュー -->
        <div class="mt-6 bg-gray-100 rounded-lg p-4">
            <div id="size-info" class="text-sm text-gray-600 mb-2"></div>
            <div id="html-preview" class="max-w-full overflow-auto"></div>
        </div>
    </div>

    <!-- スクリプト -->
    <script>
        // 変換時間の推定関数を追加
        function estimateConversionTime(totalPages, format) {
            // ページ数と形式に基づいて変換時間を推定
            const baseTime = 1; // 初期処理の基本時間
            let timePerPage = 0;

            switch(format) {
                case 'pdf':
                    timePerPage = 0.5; // PDFは比較的軽い
                    break;
                case 'jpg':
                    timePerPage = 1; // JPGは少し重い
                    break;
                case 'svg':
                    timePerPage = 0.3; // SVGは最も軽い
                    break;
                default:
                    timePerPage = 0.5;
            }

            // 処理時間を計算
            const totalTime = baseTime + (totalPages * timePerPage);
            
            // 時間を整形
            if (totalTime < 1) {
                return '1秒未満';
            } else if (totalTime < 60) {
                return `約${Math.round(totalTime)}秒`;
            } else {
                const minutes = Math.floor(totalTime / 60);
                const seconds = Math.round(totalTime % 60);
                return `約${minutes}分${seconds}秒`;
            }
        }

        // 既存のcheckMultiplePagesに推定時間表示を追加
        function checkMultiplePages(content) {
            // 既存のcheckMultiplePagesの処理を保持
            // ... (以前のコード)

            // 推定変換時間の表示
            const estimatedTimeEl = document.getElementById('estimated-time');
            const format = selectedFormat || 'pdf';
            const estimatedTime = estimateConversionTime(pageCount, format);
            
            if (hasMultiplePages) {
                estimatedTimeEl.textContent = `推定変換時間: ${estimatedTime}`;
            } else {
                estimatedTimeEl.textContent = '';
            }
        }

        // ファイル選択イベントにドラッグ＆ドロップを追加
        const fileInput = document.getElementById('html-file');
        const fileDropZone = fileInput.closest('.border-2');

        // ドラッグオーバー
        fileDropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileDropZone.classList.add('border-blue-500', 'bg-blue-50/10');
        });

        // ドラッグリーブ
        fileDropZone.addEventListener('dragleave', () => {
            fileDropZone.classList.remove('border-blue-500', 'bg-blue-50/10');
        });

        // ドロップ
        fileDropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            fileDropZone.classList.remove('border-blue-500', 'bg-blue-50/10');
            
            // ファイルを設定
            fileInput.files = e.dataTransfer.files;
            
            // change イベントを発火
            const event = new Event('change');
            fileInput.dispatchEvent(event);
        });
    </script>
    <script src="script.js"></script>
</body>
</html>
